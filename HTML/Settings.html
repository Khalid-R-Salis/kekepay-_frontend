<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="../styles/Settings.css" />
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.8/css/line.css"
    />
    <script src="main.js"></script>
  </head>

  <body>
    <div class="mobilenav" id="mobilenav">
      <ul>
        <li>
          <a class="first" href="../HTML/Dashboard.html">Dashboard</a>
        </li>
        <li>
          <a class="second" href="../HTML/Payments.html">Payment</a>
        </li>
        <li>
          <a class="third" href="../HTML/Transactions.html">Transactions</a>
        </li>
        <li>
          <a class="fourth" href="../HTML/Settings.html">Settings</a>
        </li>

        <div class="referdown" style="margin-top: 30px">
          <li><a href="Refer.html">Refer a friend</a></li>
          <li>
            <a href="Login.html">Log out <i class="uil uil-signout"></i></a>
          </li>
        </div>
      </ul>
    </div>

    <div class="topnav">
      <img class="navlogo" src="../Images/logo.jpg" alt="" />
      <img id="navshow" src="../Images/icon-menu.svg" alt="" />
    </div>

    <div class="container">
      <aside>
        <img class="logo" src="../Images__Dashboard/logo.jpg" alt="" />
        <div class="container__aside">
          <div class="links__top">
            <nav>
              <ul>
                <li>
                  <a class="first" href="Dashboard.html"
                    ><i class="uil uil-create-dashboard"></i>Dashboard</a
                  >
                </li>
                <li>
                  <a class="second" href="Payments.html"
                    ><i class="uil uil-transaction"></i>Payment</a
                  >
                </li>
                <li>
                  <a class="third" href="Transactions.html"
                    ><i class="uil uil-notes"></i>Transactions</a
                  >
                </li>
                <li>
                  <a class="fourth" href="Dashboard.html"
                    ><i class="uil uil-cog"></i>Settings</a
                  >
                </li>
              </ul>
            </nav>
          </div>

          <div class="links__bottom">
            <ul>
              <li><a href="Refer.html">Refer a friend</a></li>
              <li><a href="">Support</a></li>
              <li>
                <a href="Login.html">Log out <i class="uil uil-signout"></i></a>
              </li>
            </ul>
          </div>
        </div>
      </aside>

      <div id="mobile" class="settings__container">
        <div class="Main__container">
          <div class="first__sec">
            <div class="first__bar">
              <h4>Personal Info</h4>
              <h5>Update your photo and Personal details here</h5>
            </div>

            <div class="info__sec">
              <form id="profile_form">
                <div class="name">
                  <h4>Name</h4>
                  <div class="classname">
                    <input
                      id="fullNameInput"
                      type="text"
                      placeholder="John James"
                    />
                  </div>
                </div>

                <div class="email">
                  <h4>Email</h4>
                  <input
                    id="emailInput"
                    type="email"
                    placeholder="JohnDoe@gmail.com"
                  />
                </div>

                <div class="reg__no">
                  <h4>Keke Registration Number</h4>
                  <input
                    id="registrationNumberInput"
                    type="tel"
                    placeholder="KK234323"
                  />
                </div>
              </form>
            </div>

            <div class="others">
              <a id="profile_link" href="Settings.html" style="display: none"
                >My Profile</a
              >
              <button id="second" style="background-color: gold">
                Save Changes
              </button>
              <a id="profile_link" href="password.html">Chang Password</a>
            </div>
          </div>
        </div>
      </div>

      <div id="desktop" class="settings__container">
        <nav>
          <ul>
            <li><a id="profile_link" href="Settings.html">My Profile</a></li>
            <li id="password_link"><a href="password.html">Password</a></li>
            <li id="notification_link">
              <a href="Notification.html">Notifications</a>
            </li>
          </ul>
        </nav>

        <div class="Main__container">
          <form action="/user/update" method="POST">
            <div class="first__sec">
              <div class="first__bar">
                <h4>Personal Info</h4>
                <h5>Update your photo and Personal details here</h5>
              </div>

              <div class="others">
                <button id="second" style="background-color: gold">
                  Save Changes
                </button>
              </div>
            </div>

            <div class="info__sec">
              <div class="name">
                <h4>Name</h4>
                <div class="classname">
                  <input type="text" placeholder="John James" />
                </div>
              </div>

              <div class="email">
                <h4>Email</h4>
                <input type="email" placeholder="JohnDoe@gmail.com" />
              </div>

              <div class="reg__no">
                <h4>Keke registration Number</h4>
                <input type="tel" placeholder="KK234323" />
              </div>
            </div>

            <div class="last__Container">
              <div class="one">
                <h4>Your photo</h4>
                <h5>This photo will be displayed on your profile</h5>
              </div>

              <div class="two">
                <img
                  src="../Images__Dashboard/Profile.png"
                  alt=""
                  height="50px"
                />
              </div>

              <div class="three">
                <img src="../Images__Dashboard/Upload.svg" alt="" />
                <h4>Click to upload</h4>
                <h5>Or drag and drop SVG, PNG or JPEG (max 800x400px)</h5>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // nav toggle
      document.addEventListener("DOMContentLoaded", function () {
        const navshow = document.getElementById("navshow");
        const mobilenav = document.getElementById("mobilenav");

        navshow.addEventListener("click", function () {
          mobilenav.classList.toggle("show");
          if (mobilenav.classList.contains("show")) {
            navshow.src = "../Images/icon-close.svg";
          } else {
            navshow.src = "../Images/icon-menu.svg";
          }
        });
      });

      const btn = document.getElementById("second");
      btn.addEventListener("click", async function (e) {
        e.preventDefault();

        // const baseUrl = 'http://localhost:5500';
        const baseUrl = "https://keke-pay-97cm.onrender.com";
        const userId = localStorage.getItem("userId");

        const updateProfile = async () => {
          const fullName = document.querySelector(".classname input").value;
          const email = document.querySelector(".email input").value;
          const registrationNumber =
            document.querySelector(".reg__no input").value;

          try {
            if (!fullName || !email || registrationNumber) {
              alert("please enter atleast one of the following input!");
            }
            const response = await fetch(`${baseUrl}/user/update/${userId}`, {
              method: "PATCH",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                fullName,
                email,
                registrationNumber,
              }),
            });

            const data = await response.json();

            if (response.ok) {
              // alert('Profile updated successfully.');
              alert(`${data.message}`);
              localStorage.setItem("fullName", data.name);
              window.location.href = "Dashboard.html";
            }
            // else {
            //     alert(`Failed to update profile. Error: ${data.message}`);
            // }
          } catch (error) {
            console.error("Error updating user profile:", error);
            alert(`Failed to update profile. Error: ${data.message}`);
          }
        };

        await updateProfile();
      });
    </script>
  </body>
</html>
